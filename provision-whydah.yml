---
# This playbook deploys Whydah to AWS AMI's

- name: Set up Whydah UserIdentityBackend
  hosts: Whydah_UserIdentityBackend
  sudo: true
  roles:
    - standard
    - configuration
    - app
  tags:
    uib
  vars:
    username: UserIdentityBackend
    group_id: net/whydah/identity
    app_name: UserIdentityBackend
    version: 0.7
    env_mode: PROD
    env_vars: -DIAM_MODE=PROD
    service_config_template: useridentitybackend.properties
    service_config: useridentitybackend.PROD.properties
  vars_files:
    - vars/uib


- name: Set up Whydah SecurityTokenService
  hosts: Whydah_SecurityTokenService
  sudo: true
  roles:
  # Note that the configuration for SecurityTokenService has not yet been found!
    - app
    - configuration
  tags:
    token
  vars:
    username: SecurityTokenService
    group_id: net/whydah/token
    app_name: SecurityTokenService
    version: 2.0.1-SNAPSHOT
    env_vars: -DIAM_MODE=PROD
    service_config_template: securitytokenservice.properties
    service_config: securitytokenservice.PROD.properties
  vars_files:
    - vars/securityTokenService

- name: Set up Whydah SSOLoginWebApp
  hosts: Whydah_SSOLoginWebApp
  sudo: true
  roles:
    - configuration
    - app
  tags:
    sso
  vars:
    username: SSOLoginWebApp
    group_id: net/whydah/sso
    app_name: SSOLoginWebApp
    version: 2.0.1-SNAPSHOT
    env_vars: -DIAM_MODE=PROD
    service_config_template: ssologinservice.properties
    service_config: ssologinservice.PROD.properties
  vars_files:
    - vars/ssoLogin

- name: Set up Whydah UserAdminWebapp
  hosts: Whydah_UserAdminWebapp
  sudo: true
  roles:
    - configuration
    - app
  tags:
    adminapp
  vars:
    username: UserAdminWebapp
    group_id: net/whydah/identity
    app_name: UserAdminWebapp
    version: 0.4-SNAPSHOT
    env_vars: -DIAM_MODE=PROD
    service_config_template: useradministration.properties
    service_config: useradministration.PROD.properties
  vars_files:
    - vars/userAdministration